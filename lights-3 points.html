<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>3D ç¯å…‰åŸç†äº¤äº’å®éªŒå®¤ - By Gemini</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #111; color: #eee; font-family: 'Segoe UI', sans-serif; }
        #canvas-container { width: 100vw; height: 100vh; display: block; }
        
        /* æ§åˆ¶é¢æ¿æ ·å¼ */
        #controls {
            position: absolute; top: 10px; left: 10px; width: 320px;
            background: rgba(30, 30, 30, 0.9); padding: 15px; border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5); border: 1px solid #444;
            max-height: 90vh; overflow-y: auto;
        }
        h2 { margin-top: 0; font-size: 16px; border-bottom: 1px solid #555; padding-bottom: 5px; color: #faac58; }
        h3 { font-size: 14px; margin: 10px 0 5px; color: #aaa; }
        .control-group { margin-bottom: 15px; border-bottom: 1px solid #333; padding-bottom: 10px; }
        label { display: flex; justify-content: space-between; font-size: 12px; margin-bottom: 5px; align-items: center; }
        input[type=range] { width: 60%; }
        input[type=color] { border: none; width: 30px; height: 20px; padding: 0; background: none; }
        button {
            width: 100%; padding: 8px; background: #444; color: white; border: none;
            border-radius: 4px; cursor: pointer; margin-top: 5px; transition: 0.2s;
        }
        button:hover { background: #555; }
        button.active { background: #faac58; color: #111; font-weight: bold; }
        
        /* åŸç†è¯´æ˜é¢æ¿ */
        #info-panel {
            position: absolute; top: 10px; right: 10px; width: 280px;
            background: rgba(30, 30, 30, 0.8); padding: 15px; border-radius: 8px;
            border-left: 3px solid #faac58; pointer-events: none;
        }
        .highlight { color: #faac58; font-weight: bold; }
        .note { font-size: 12px; color: #bbb; line-height: 1.5; }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
</head>
<body>

<div id="controls">
    <h2>ğŸ›ï¸ ç¯å…‰æ§åˆ¶å°</h2>
    
    <div class="control-group">
        <h3>å…¨å±€è®¾ç½®</h3>
        <label><span>ç‰©ä½“æè´¨ç²—ç³™åº¦</span> <input type="range" id="roughness" min="0" max="1" step="0.01" value="0.2"></label>
        <label><span>ç‰©ä½“é‡‘å±åº¦</span> <input type="range" id="metalness" min="0" max="1" step="0.01" value="0.8"></label>
        <button id="anim-toggle">â¯ï¸ å¼€å¯/åœæ­¢ åŠ¨æ€æ‰«å…‰åŠ¨ç”»</button>
        <div style="font-size:11px; color:#888; margin-top:5px;">*æ‰«å…‰åŠ¨ç”»æ¨¡æ‹Ÿäº§å“å±•ç¤ºæ—¶çš„ç¯å…‰ç§»åŠ¨</div>
    </div>

    <div class="control-group">
        <h3>ğŸ’¡ ä¸»å…‰ (Key Light) - å¡‘é€ å½¢ä½“</h3>
        <label><span>å¼€å…³</span> <input type="checkbox" id="key-visible" checked></label>
        <label><span>å¼ºåº¦ (Power)</span> <input type="range" id="key-intensity" min="0" max="2" step="0.1" value="1.2"></label>
        <label><span>é¢œè‰² (Color)</span> <input type="color" id="key-color" value="#ffffff"></label>
        <label><span>X ä½ç½® (å·¦å³)</span> <input type="range" id="key-x" min="-10" max="10" step="0.1" value="5"></label>
        <label><span>Y ä½ç½® (é«˜ä½)</span> <input type="range" id="key-y" min="0" max="10" step="0.1" value="5"></label>
        <label><span>Z ä½ç½® (å‰å)</span> <input type="range" id="key-z" min="-10" max="10" step="0.1" value="5"></label>
    </div>

    <div class="control-group">
        <h3>ğŸ”¦ è¡¥å…‰ (Fill Light) - å¡«å……é˜´å½±</h3>
        <label><span>å¼€å…³</span> <input type="checkbox" id="fill-visible" checked></label>
        <label><span>å¼ºåº¦ (Power)</span> <input type="range" id="fill-intensity" min="0" max="2" step="0.1" value="0.5"></label>
        <label><span>é¢œè‰² (å†·æš–å¯¹æ¯”)</span> <input type="color" id="fill-color" value="#aaccff"></label>
        <label><span>X ä½ç½®</span> <input type="range" id="fill-x" min="-10" max="10" step="0.1" value="-6"></label>
    </div>

    <div class="control-group">
        <h3>âœ¨ è½®å»“å…‰ (Rim Light) - è¾¹ç¼˜å‰¥ç¦»</h3>
        <label><span>å¼€å…³</span> <input type="checkbox" id="rim-visible" checked></label>
        <label><span>å¼ºåº¦ (Power)</span> <input type="range" id="rim-intensity" min="0" max="5" step="0.1" value="3"></label>
        <label><span>é¢œè‰² (Color)</span> <input type="color" id="rim-color" value="#ffffff"></label>
        <label><span>Z ä½ç½® (èƒŒå…‰è·ç¦»)</span> <input type="range" id="rim-z" min="-10" max="0" step="0.1" value="-4"></label>
    </div>
</div>

<div id="info-panel">
    <h3>ğŸ“ åŸç†ç¬”è®°</h3>
    <div id="info-content" class="note">
        <p><span class="highlight">ä¸»å…‰ (Key):</span> å†³å®šç‰©ä½“çš„æ˜æš—äº¤ç•Œçº¿ã€‚é€šå¸¸æ”¾åœ¨ 45Â° è§’ã€‚</p>
        <p><span class="highlight">è¡¥å…‰ (Fill):</span> ç…§äº®ä¸»å…‰ç•™ä¸‹çš„æ­»é»‘é˜´å½±ã€‚æ³¨æ„çœ‹å·¦ä¾§æš—éƒ¨ï¼Œå¦‚æœä¸åŠ è¡¥å…‰ï¼Œç»†èŠ‚ä¼šä¸¢å¤±ã€‚</p>
        <p><span class="highlight">è½®å»“å…‰ (Rim):</span> è¯·çœ‹ç‰©ä½“è¾¹ç¼˜é‚£å±‚äº®è¾¹ã€‚å®ƒæŠŠæ·±è‰²ç‰©ä½“ä»æ·±è‰²èƒŒæ™¯ä¸­åˆ‡å‡ºæ¥ã€‚è¿™æ˜¯äº§å“æ¸²æŸ“â€œé«˜çº§æ„Ÿâ€çš„å…³é”®ã€‚</p>
        <hr style="border:0; border-top:1px solid #555;">
        <p>ğŸ”´ <b>çº¢è‰²çº¿æ¡</b> ä»£è¡¨ç¯å…‰ç…§å°„æ–¹å‘ã€‚</p>
        <p>ğŸŸ¡ <b>é»„è‰²ç½‘æ ¼</b> ä»£è¡¨ç¯å…‰ç‰©ç†ä½ç½®ã€‚</p>
    </div>
</div>

<div id="canvas-container"></div>

<script>
    // 1. åˆå§‹åŒ–åœºæ™¯ (Scene Setup)
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x111111); // Blender çš„æ·±ç°èƒŒæ™¯
    scene.fog = new THREE.Fog(0x111111, 10, 50); // å¢åŠ ä¸€ç‚¹æ·±åº¦é›¾

    const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 100);
    camera.position.set(0, 2, 12); // ç›¸æœºä½ç½®

    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.shadowMap.enabled = true; // å¼€å¯é˜´å½±
    renderer.shadowMap.type = THREE.PCFSoftShadowMap; // æŸ”å’Œé˜´å½±
    renderer.toneMapping = THREE.ACESFilmicToneMapping; // æ¨¡æ‹Ÿ Blender Filmic æ•ˆæœ
    document.getElementById('canvas-container').appendChild(renderer.domElement);

    // 2. åˆ›å»ºç‰©ä½“ (The "Product")
    // ä½¿ç”¨ TorusKnot (æ‰­ç»“) å› ä¸ºå®ƒæœ‰å¤æ‚çš„æ›²é¢ï¼Œæœ€èƒ½ä½“ç°å…‰å½±
    const geometry = new THREE.TorusKnotGeometry(1.5, 0.5, 128, 32);
    const material = new THREE.MeshStandardMaterial({ 
        color: 0x333333, 
        roughness: 0.2, // å¯¹åº” Blender çš„ Roughness
        metalness: 0.8  // å¯¹åº” Blender çš„ Metallic
    });
    const mesh = new THREE.Mesh(geometry, material);
    mesh.castShadow = true;
    mesh.receiveShadow = true;
    mesh.position.y = 1;
    scene.add(mesh);

    // åœ°é¢ (æ¥æ”¶é˜´å½±)
    const planeGeometry = new THREE.PlaneGeometry(100, 100);
    const planeMaterial = new THREE.MeshStandardMaterial({ color: 0x080808, roughness: 0.8 });
    const plane = new THREE.Mesh(planeGeometry, planeMaterial);
    plane.rotation.x = -Math.PI / 2;
    plane.position.y = -1.5;
    plane.receiveShadow = true;
    scene.add(plane);

    // 3. ç¯å…‰ç³»ç»Ÿ (Lighting System)

    // A. ä¸»å…‰ (Key Light) - SpotLight æ¨¡æ‹Ÿå½±æ£šèšå…‰ç¯
    const keyLight = new THREE.SpotLight(0xffffff, 1.2);
    keyLight.position.set(5, 5, 5);
    keyLight.angle = Math.PI / 6;
    keyLight.penumbra = 0.5; // è¾¹ç¼˜æŸ”åŒ–
    keyLight.castShadow = true;
    keyLight.shadow.mapSize.width = 1024;
    keyLight.shadow.mapSize.height = 1024;
    scene.add(keyLight);
    // è¾…åŠ©çº¿
    const keyHelper = new THREE.SpotLightHelper(keyLight);
    scene.add(keyHelper);

    // B. è¡¥å…‰ (Fill Light) - PointLight æ¨¡æ‹ŸæŸ”å…‰ç®± (æ— é˜´å½±ï¼Œåªè¡¥äº®åº¦)
    const fillLight = new THREE.PointLight(0xaaccff, 0.5);
    fillLight.position.set(-6, 2, 6);
    scene.add(fillLight);
    const fillHelper = new THREE.PointLightHelper(fillLight, 0.5);
    scene.add(fillHelper);

    // C. è½®å»“å…‰ (Rim Light) - SpotLight èƒŒå…‰
    const rimLight = new THREE.SpotLight(0xffffff, 3);
    rimLight.position.set(0, 4, -4);
    rimLight.lookAt(mesh.position);
    rimLight.castShadow = false; // è½®å»“å…‰é€šå¸¸ä¸äº§ç”Ÿä¸»é˜´å½±
    scene.add(rimLight);
    const rimHelper = new THREE.SpotLightHelper(rimLight); 
    scene.add(rimHelper);


    // 4. äº¤äº’é€»è¾‘ (Interaction)
    
    // æ›´æ–°å‡½æ•°
    function updateLights() {
        // æè´¨æ›´æ–°
        material.roughness = parseFloat(document.getElementById('roughness').value);
        material.metalness = parseFloat(document.getElementById('metalness').value);

        // ä¸»å…‰æ›´æ–°
        keyLight.visible = document.getElementById('key-visible').checked;
        keyLight.intensity = parseFloat(document.getElementById('key-intensity').value);
        keyLight.color.set(document.getElementById('key-color').value);
        keyLight.position.set(
            parseFloat(document.getElementById('key-x').value),
            parseFloat(document.getElementById('key-y').value),
            parseFloat(document.getElementById('key-z').value)
        );
        keyHelper.update();
        keyHelper.visible = keyLight.visible;

        // è¡¥å…‰æ›´æ–°
        fillLight.visible = document.getElementById('fill-visible').checked;
        fillLight.intensity = parseFloat(document.getElementById('fill-intensity').value);
        fillLight.color.set(document.getElementById('fill-color').value);
        fillLight.position.x = parseFloat(document.getElementById('fill-x').value);
        fillHelper.update();
        fillHelper.visible = fillLight.visible;

        // è½®å»“å…‰æ›´æ–°
        rimLight.visible = document.getElementById('rim-visible').checked;
        rimLight.intensity = parseFloat(document.getElementById('rim-intensity').value);
        rimLight.color.set(document.getElementById('rim-color').value);
        rimLight.position.z = parseFloat(document.getElementById('rim-z').value);
        rimLight.lookAt(mesh.position); // å§‹ç»ˆå¯¹å‡†ç‰©ä½“
        rimHelper.update();
        rimHelper.visible = rimLight.visible;
    }

    // äº‹ä»¶ç›‘å¬
    document.querySelectorAll('input').forEach(input => {
        input.addEventListener('input', updateLights);
    });

    // åŠ¨ç”»å¾ªç¯
    let isAnimating = false;
    let time = 0;
    document.getElementById('anim-toggle').addEventListener('click', () => {
        isAnimating = !isAnimating;
        document.getElementById('anim-toggle').classList.toggle('active');
    });

    // é¼ æ ‡æ—‹è½¬ (ç®€å•çš„æ¨¡æ‹Ÿ)
    let mouseX = 0, mouseY = 0;
    document.addEventListener('mousemove', (event) => {
        mouseX = (event.clientX - window.innerWidth / 2) / 100;
        mouseY = (event.clientY - window.innerHeight / 2) / 100;
    });

    function animate() {
        requestAnimationFrame(animate);

        // ç®€å•çš„ç›¸æœºäº¤äº’
        camera.position.x += (mouseX - camera.position.x) * 0.05;
        camera.position.y += (-mouseY + 2 - camera.position.y) * 0.05;
        camera.lookAt(scene.position);

        // æ‰«å…‰åŠ¨ç”»é€»è¾‘
        if (isAnimating) {
            time += 0.02;
            // è®©ä¸»å…‰å·¦å³æ‘‡æ‘†
            keyLight.position.x = Math.sin(time) * 8;
            document.getElementById('key-x').value = keyLight.position.x; // åŒæ­¥UI
            keyHelper.update();
        }

        // æ…¢æ…¢æ—‹è½¬ç‰©ä½“å±•ç¤ºé«˜å…‰
        mesh.rotation.y += 0.005;
        mesh.rotation.x += 0.002;

        renderer.render(scene, camera);
    }

    animate();

    // çª—å£å¤§å°è°ƒæ•´
    window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    });

</script>
</body>
</html>